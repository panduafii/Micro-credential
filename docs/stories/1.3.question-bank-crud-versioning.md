# Story 1.3: Question Bank CRUD and Versioning

## Status
- ✅ Completed

## Story
**As an** admin,  
**I want** to manage question pools per track,  
**so that** theoretical, essay, and profile questions stay aligned with role requirements.

## Acceptance Criteria
1. ✅ Question CRUD endpoints support type, prompt, track tags, and rubric/rules payloads.
2. ✅ Soft delete keeps historical data while removing items from active rotations.
3. ✅ Version snapshot stored when questions change.
4. ✅ Unit tests cover rule parsing and rubric validation.

## Implementation Details

### API Endpoints
| Method | Endpoint | Auth | Description |
|--------|----------|------|-------------|
| GET | `/questions` | Public | List all active questions (filterable by role_slug) |
| GET | `/questions/{id}` | Public | Get question details by ID |
| POST | `/questions` | Admin | Create new question |
| PATCH | `/questions/{id}` | Admin | Update question (creates new version) |
| DELETE | `/questions/{id}` | Admin | Soft-delete question |

### Data Model
```python
class QuestionTemplate:
    id: int
    role_slug: str (FK to RoleCatalog)
    sequence: int
    question_type: QuestionType (theoretical, essay, profile)
    prompt: str
    metadata_: dict | None  # rubric, rules, dimension
    version: int
    previous_version_id: int | None
    is_active: bool
    created_at: datetime
    updated_at: datetime
```

### Versioning Strategy
- On update: old question marked `is_active=False`
- New question created with `version+1` and `previous_version_id` pointing to old
- Historical data preserved for audit trail

### Files Changed
- `src/api/routes/questions.py` - CRUD endpoints with serialization helper
- `src/api/schemas/questions.py` - Pydantic schemas with metadata validation
- `src/infrastructure/db/models.py` - QuestionTemplate versioning fields
- `alembic/versions/202412250003_add_question_versioning.py` - Migration
- `tests/unit/test_questions_crud.py` - Unit tests (11 tests)

### Test Coverage
- `test_create_question_success`
- `test_create_question_duplicate_sequence`
- `test_create_question_requires_admin`
- `test_list_questions_all`
- `test_list_questions_filtered`
- `test_get_question_success`
- `test_get_question_not_found`
- `test_update_question_creates_version`
- `test_update_question_requires_admin`
- `test_delete_question_soft_delete`
- `test_delete_question_requires_admin`

## Change Log
| Date       | Version | Description | Author |
|------------|---------|-------------|--------|
| 2025-12-25 | 1.0     | Completed implementation with versioning | Dev Agent |
