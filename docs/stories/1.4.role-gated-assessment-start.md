# Story 1.4: Role-Gated Assessment Start

## Status
- ✅ Completed

## Story
**As a** student,  
**I want** to start an assessment by choosing a role,  
**so that** I receive questions aligned with that track.

## Acceptance Criteria
1. ✅ `POST /api/v1/assessments/start` requires `trackId` and validates eligibility.
2. ✅ Endpoint assembles three theoretical, three essay, and four profile questions mapped to the selected track, snapshots prompts, and returns bundle <400 ms p95.
3. ✅ Partial response tokens created with expiry and resume capability.
4. ✅ API captures analytics event tying student, track, and assessment ID.

## Implementation Details

### API Endpoint
| Method | Endpoint | Auth | Description |
|--------|----------|------|-------------|
| POST | `/assessments/start` | Student | Start or resume an assessment |

### Request/Response
```json
// Request
{
  "role_slug": "backend-engineer"
}

// Response
{
  "assessment_id": "uuid",
  "status": "draft",
  "expires_at": "2025-12-26T10:00:00Z",
  "role": {
    "slug": "backend-engineer",
    "name": "Backend Engineer",
    "description": "...",
    "question_count": 10
  },
  "questions": [
    {
      "id": "uuid",
      "sequence": 1,
      "question_type": "theoretical",
      "prompt": "...",
      "metadata": {...},
      "response": null
    }
  ]
}
```

### Question Mix (AC2)
Default distribution per role:
- **3 Theoretical** questions
- **3 Essay** questions  
- **4 Profile** questions
- Total: **10 questions**

Can be overridden via `RoleCatalog.question_mix_overrides`.

### Expiry & Resume (AC3)
- Default expiry: **24 hours** from creation
- If student calls `/start` with same role and has active assessment → resumes existing
- Assessment statuses: `draft`, `in_progress`, `completed`

### Analytics Logging (AC4)
Structured log event on start/resume:
```json
{
  "event_type": "assessment_start",
  "student_id": "user-123",
  "track_slug": "backend-engineer",
  "assessment_id": "uuid",
  "question_count": 10,
  "expires_at": "2025-12-26T10:00:00Z"
}
```

### Files Changed
- `src/api/routes/assessments.py` - Start endpoint
- `src/api/schemas/assessments.py` - Request/response schemas with expires_at
- `src/domain/services/assessments.py` - AssessmentService with question mix logic
- `src/infrastructure/db/models.py` - Assessment.expires_at field
- `alembic/versions/202412250004_add_assessment_expiry.py` - Migration
- `tests/unit/test_assessments.py` - Unit tests (5 tests)

### Test Coverage
- `test_assessment_start_creates_payload`
- `test_assessment_start_resumes_existing`
- `test_assessment_start_unknown_role_returns_404`
- `test_assessment_has_expiry`
- `test_assessment_question_mix`

## Change Log
| Date       | Version | Description | Author |
|------------|---------|-------------|--------|
| 2025-12-25 | 1.0     | Initial implementation | Dev Agent |
| 2025-12-25 | 1.1     | Added question mix, expiry, analytics | Dev Agent |
